<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BRoll Shuffler</title>
</head>
<body>
  <h1>ğŸï¸ BRoll Shuffler</h1>
  <video id="player" width="720" height="405" controls autoplay></video>
  <div id="label" style="margin-top: 10px; font-size: 18px;"></div>

  <script>
    const videoData = [
      { id: "VIDEO_ID_1", label: "Sample Clip 1", tags: ["sample", "test"], duration: 120 },
      { id: "VIDEO_ID_2", label: "Sample Clip 2", tags: ["example", "demo"], duration: 90 }
    ];

    const maxSeconds = 120;
    const filtered = videoData.map(v => {
      if (v.duration > maxSeconds) {
        v.duration = maxSeconds;
      }
      return v;
    });

    function shuffle(array) {
      let currentIndex = array.length, randomIndex;
      while (currentIndex !== 0) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;
        [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
      }
      return array;
    }

    let playlist = shuffle(filtered);
    let index = 0;
    const player = document.getElementById('player');
    const labelDiv = document.getElementById('label');

    function getDriveURL(id) {
      return `https://drive.google.com/uc?export=preview&id=${id}`;
    }

    function playNext() {
      if (index >= playlist.length) {
        index = 0;
        playlist = shuffle(playlist);
      }
      const clip = playlist[index];
      labelDiv.textContent = clip.label;
      player.src = getDriveURL(clip.id);
      player.load();
      player.play();

      setTimeout(() => {
        player.pause();
        index++;
        playNext();
      }, clip.duration * 1000);
    }

    player.addEventListener('ended', () => {
      index++;
      playNext();
    });

    playNext();
  </script>
</body>
</html>
